<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éŸ“åœ‹é€£ç·šä»£è³¼è¨ˆç®—æ©Ÿ V3.1</title>
    <style>
        :root {
            --primary-pink: #fff5f5;
            --accent-pink: #ffb6b6;
            --soft-gray: #f8f9fa;
            --text-gray: #555;
            --warning-red: #ff4d4d;
            --formula-blue: #5a8ab9;
            --profit-green: #2e7d32;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--primary-pink);
            color: var(--text-gray);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            background: white;
            width: 100%;
            max-width: 400px;
            padding: 25px;
            border-radius: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }
        h2 { text-align: center; color: var(--accent-pink); margin-bottom: 25px; font-size: 1.4rem; letter-spacing: 2px; }
        .section { margin-bottom: 18px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9rem; color: #777; }
        
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 14px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            font-size: 1rem;
            box-sizing: border-box;
            outline: none;
            -webkit-appearance: none;
        }
        input:focus { border-color: var(--accent-pink); background: #fffdfd; }

        .row { display: flex; gap: 10px; align-items: center; margin-top: 5px; }
        .checkbox-group { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; cursor: pointer; }
        
        input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--accent-pink); }

        .result-card {
            background: var(--soft-gray);
            padding: 20px;
            border-radius: 20px;
            margin-top: 20px;
            border: 2px solid #eee;
        }
        .price-tag { font-size: 2.2rem; color: #333; font-weight: 800; text-align: center; margin: 10px 0; }
        .price-tag span { font-size: 1rem; margin-left: 5px; color: #666; }
        
        /* å ±åƒ¹æ˜ç´°æ¨£å¼ */
        .detail-text {
            font-size: 0.85rem;
            color: #888;
            line-height: 1.6;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        /* æ·¨åˆ©å±•é–‹å€æ¨£å¼ */
        details {
            margin-top: 15px;
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            overflow: hidden;
        }
        summary {
            padding: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--profit-green);
            cursor: pointer;
            list-style: none;
            text-align: center;
            background: #f1f8f1;
        }
        .profit-content { padding: 15px; font-size: 0.85rem; line-height: 1.8; }
        .profit-line { display: flex; justify-content: space-between; margin-bottom: 4px; }

        .formula-box {
            margin-top: 15px;
            padding: 12px;
            background: #eef4f9;
            border-radius: 12px;
            font-family: monospace;
            font-size: 0.75rem;
            color: var(--formula-blue);
            word-break: break-all;
        }
        .custom-fee-box, .shipping-box { 
            display: none; margin-top: 10px; padding: 10px;
            background: #fffafa; border-radius: 12px; border: 1px solid #ffecec;
        }
        .quote-label {
            display: inline-block; padding: 4px 12px; border-radius: 20px;
            font-size: 0.75rem; font-weight: bold; margin-bottom: 5px;
        }
        .label-no-ship { background: #e3f2fd; color: #1976d2; }
        .label-with-ship { background: #e8f5e9; color: #388e3c; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ‡°ğŸ‡· å°å¹«æ‰‹ã®è¨ˆç®—æ©Ÿ</h2>

    <div class="section">
        <label>ğŸ’° å•†å“éŸ“å¹£æ¨™åƒ¹ (KRW)</label>
        <input type="text" id="krwInput" inputmode="numeric" placeholder="è«‹è¼¸å…¥é‡‘é¡" oninput="calculate()">
    </div>

    <div class="section">
        <label>ğŸ ä»£è³¼å“é …</label>
        <select id="category" onchange="updateRateOptions()">
            <option value="1" data-rates="5,6,7,8">1. ç©å¶é¡ (5-8%)</option>
            <option value="2" data-rates="8,9,10,12,15">2. å’–å•¡å»³å‘¨é‚Š (8-15%)</option>
            <option value="3" data-rates="5,6,7,8">3. æ–‡å‰µå°åŠé£¾ (5-8%)</option>
            <option value="4" data-rates="5">4. æ˜ä¿¡ç‰‡/è²¼ç´™ (5%)</option>
            <option value="5" data-rates="5,6,7,8">5. å¤§å‰µé™å®š (5-8%)</option>
            <option value="6" data-rates="8,9,10">6. Olive Young (8-10%)</option>
            <option value="9" data-rates="8,9,10">9. æ¯ç›¤ (éœ€åŠ è™•ç†è²»)</option>
            <option value="11" data-rates="10,12,15">11. romand é™å®š (10-15%)</option>
            <option value="13" data-rates="10,12">13. é‹é¡/é‡ç‰© (10-12%)</option>
        </select>
    </div>

    <div class="section">
        <label>ğŸ“ˆ æœå‹™è²»ç‡ (%)</label>
        <div class="row">
            <select id="rateSelect" onchange="calculate()"></select>
            <label class="checkbox-group">
                <input type="checkbox" id="isCustomRate" onchange="toggleCustomRate()"> è‡ªè¨‚
            </label>
        </div>
        <div id="customRateBox" class="custom-fee-box">
            <input type="text" id="customRateInput" inputmode="numeric" placeholder="è¼¸å…¥è²»ç‡ (ä¾‹å¦‚ 12)" oninput="calculate()">
        </div>
    </div>

    <div class="section">
        <div class="row" style="margin-bottom: 10px;">
            <div style="flex:1">
                <label>ğŸ“¦ è™•ç†è²» H (TWD)</label>
                <input type="text" id="hCost" inputmode="numeric" value="0" oninput="calculate()">
            </div>
        </div>
        <label class="checkbox-group">
            <input type="checkbox" id="includeShipping" onchange="toggleShipping()"> åŠ ä¸Šå°ç£é‹è²» S
        </label>
        <div id="shippingBox" class="shipping-box">
            <input type="text" id="sCost" inputmode="numeric" value="39" oninput="calculate()">
        </div>
    </div>

    <div class="result-card">
        <div id="quoteStatus" class="quote-label label-no-ship">ç´”å•†å“å ±åƒ¹</div>
        <div class="price-tag" id="totalDisplay">0<span>TWD</span></div>
        <div id="minFeeWarning" style="color:red; font-size: 0.8rem; display:none; text-align:center;">âš ï¸ æœå‹™è²»å·²æŒ‰ $50 ä¿åº•è¨ˆç®—</div>
        
        <div class="detail-text" id="detailText">
            è«‹è¼¸å…¥é‡‘é¡é–‹å§‹è¨ˆç®—...
        </div>

        <details id="profitDetails">
            <summary> ğŸ“ˆ æŸ¥çœ‹å°å…§è¨ˆç®—æ·¨åˆ©</summary>
            <div class="profit-content" id="profitContent">
                è«‹å…ˆè¼¸å…¥é‡‘é¡...
            </div>
        </details>

        <div class="formula-box" id="formulaDisplay">
            å…¬å¼å›å ±ï¼šç­‰å¾…è¼¸å…¥ä¸­...
        </div>
    </div>
</div>

<script>
    const R_OUT = 42; // å°å¤–å ±åƒ¹åŒ¯ç‡
    const R_ACT = 45; // å°å…§å¯¦éš›åŒ¯ç‡
    const M = 50; 

    function updateRateOptions() {
        const category = document.getElementById('category');
        const selected = category.options[category.selectedIndex];
        const rates = selected.getAttribute('data-rates').split(',');
        const rateSelect = document.getElementById('rateSelect');
        rateSelect.innerHTML = '';
        rates.forEach(r => {
            let opt = document.createElement('option');
            opt.value = r; opt.innerHTML = r + '%';
            rateSelect.appendChild(opt);
        });
        calculate();
    }

    function toggleCustomRate() {
        const isCustom = document.getElementById('isCustomRate').checked;
        document.getElementById('customRateBox').style.display = isCustom ? 'block' : 'none';
        document.getElementById('rateSelect').disabled = isCustom;
        calculate();
    }

    function toggleShipping() {
        const hasShipping = document.getElementById('includeShipping').checked;
        document.getElementById('shippingBox').style.display = hasShipping ? 'block' : 'none';
        const statusLabel = document.getElementById('quoteStatus');
        statusLabel.innerText = hasShipping ? "å«é‹ç¸½è¨ˆé‡‘é¡" : "ç´”å•†å“å ±åƒ¹";
        statusLabel.className = hasShipping ? "quote-label label-with-ship" : "quote-label label-no-ship";
        calculate();
    }

    function roundToTen(num) { return Math.round(num / 10) * 10; }

    function calculate() {
        const P = parseFloat(document.getElementById('krwInput').value) || 0;
        const H = parseFloat(document.getElementById('hCost').value) || 0;
        const hasShipping = document.getElementById('includeShipping').checked;
        const S = hasShipping ? (parseFloat(document.getElementById('sCost').value) || 0) : 0;
        
        let rPercent;
        if (document.getElementById('isCustomRate').checked) {
            rPercent = parseFloat(document.getElementById('customRateInput').value) || 0;
        } else {
            rPercent = parseFloat(document.getElementById('rateSelect').value) || 0;
        }
        const r = rPercent / 100;

        if (P <= 0) {
            document.getElementById('totalDisplay').innerHTML = '0<span>TWD</span>';
            document.getElementById('detailText').innerHTML = 'è«‹è¼¸å…¥é‡‘é¡é–‹å§‹è¨ˆç®—...';
            document.getElementById('profitContent').innerHTML = 'è«‹è¼¸å…¥é‡‘é¡ä»¥è¨ˆç®—æ·¨åˆ©';
            document.getElementById('formulaDisplay').innerText = 'å…¬å¼å›å ±ï¼šç­‰å¾…è¼¸å…¥ä¸­...';
            return;
        }

        // --- å°å¤–è¨ˆç®— (å ±åƒ¹ç”¨) ---
        const twdBaseOut = P / R_OUT;
        let serviceFee = twdBaseOut * r;
        let isMinFeeUsed = false;
        if (serviceFee < M) { serviceFee = M; isMinFeeUsed = true; }
        
        const rawTotalOut = twdBaseOut + serviceFee + H + S;
        const finalTotal = roundToTen(rawTotalOut);

        // --- å°å…§è¨ˆç®— (æ·¨åˆ©åˆ†æ) ---
        const twdBaseActual = P / R_ACT; 
        const spreadProfit = twdBaseOut - twdBaseActual; 
        const totalProfit = serviceFee + H + spreadProfit; 

        // æ›´æ–° UI
        document.getElementById('totalDisplay').innerHTML = `${finalTotal}<span>TWD</span>`;
        document.getElementById('minFeeWarning').style.display = isMinFeeUsed ? 'block' : 'none';
        
        // 1. ä¿ç•™ä¸¦æ›´æ–°å°å¤–å ±åƒ¹æ˜ç´° (ä¾ç…§ä½ çš„éœ€æ±‚)
        document.getElementById('detailText').innerHTML = `
            â€¢ å•†å“å ±åƒ¹ï¼š$${twdBaseOut.toFixed(1)} (1:${R_OUT})<br>
            â€¢ æœå‹™è²»ï¼š$${serviceFee.toFixed(1)} (${isMinFeeUsed ? 'ä¿åº•$50' : rPercent+'%'})<br>
            â€¢ å…¶ä»–ï¼šè™•ç†è²» $${H} / é‹è²» $${S}
        `;

        // 2. æ›´æ–°å°å…§æ·¨åˆ©å€
        document.getElementById('profitContent').innerHTML = `
            <div class="profit-line"><span>å¯¦éš›å•†å“æˆæœ¬ (1:${R_ACT})ï¼š</span><span>$${twdBaseActual.toFixed(0)}</span></div>
            <div class="profit-line"><span>åŒ¯å·®æ”¶ç›Šï¼š</span><span>+$${spreadProfit.toFixed(0)}</span></div>
            <div class="profit-line"><span>æœå‹™è²»æ”¶ç›Šï¼š</span><span>+$${serviceFee.toFixed(0)}</span></div>
            <div class="profit-line"><span>è™•ç†è²»æ”¶ç›Šï¼š</span><span>+$${H.toFixed(0)}</span></div>
            <div class="profit-line" style="color:var(--profit-green); font-weight:bold; font-size:1.1rem; margin-top:5px; border-top:1px solid #eee; padding-top:5px;">
                <span>ğŸ’° é ä¼°ç¸½æ·¨åˆ©ï¼š</span><span>$${totalProfit.toFixed(0)}</span>
            </div>
        `;

        // 3. å…¬å¼å›å ±
        const feeStr = isMinFeeUsed ? `max(${twdBaseOut.toFixed(0)}*${r}, 50)` : `(${twdBaseOut.toFixed(0)}*${r})`;
        let formulaText = `(${P}Ã·${R_OUT}) + ${feeStr}`;
        if (H > 0) formulaText += ` + ${H}`;
        if (S > 0) formulaText += ` + ${S}`;
        formulaText += ` = ${rawTotalOut.toFixed(1)} â†’ å ±åƒ¹ï¼š${finalTotal}`;
        document.getElementById('formulaDisplay').innerText = `å…¬å¼ï¼š${formulaText}`;
    }

    updateRateOptions();
</script>

</body>
</html>
