<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éŸ“åœ‹é€£ç·šä»£è³¼è¨ˆç®—æ©Ÿ</title>
    <style>
        :root {
            --primary-pink: #fff5f5;
            --accent-pink: #ffb6b6;
            --soft-gray: #f8f9fa;
            --text-gray: #555;
            --warning-red: #ff4d4d;
            --formula-blue: #5a8ab9;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--primary-pink);
            color: var(--text-gray);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            background: white;
            width: 100%;
            max-width: 400px;
            padding: 25px;
            border-radius: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }
        h2 { text-align: center; color: var(--accent-pink); margin-bottom: 25px; font-size: 1.4rem; letter-spacing: 2px; }
        .section { margin-bottom: 18px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 0.9rem; color: #777; }
        
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 14px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            font-size: 1rem;
            box-sizing: border-box;
            outline: none;
            transition: all 0.3s;
            -webkit-appearance: none;
        }
        input:focus { border-color: var(--accent-pink); background: #fffdfd; }

        .row { display: flex; gap: 10px; align-items: center; margin-top: 5px; }
        .checkbox-group { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; cursor: pointer; }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--accent-pink);
        }

        .result-card {
            background: var(--soft-gray);
            padding: 20px;
            border-radius: 20px;
            margin-top: 20px;
            border: 2px solid #eee;
        }
        .price-tag { font-size: 2.2rem; color: #333; font-weight: 800; text-align: center; margin: 10px 0; }
        .price-tag span { font-size: 1rem; margin-left: 5px; color: #666; }
        
        .tip { font-size: 0.85rem; color: #888; line-height: 1.6; }
        .warning { color: var(--warning-red); font-weight: bold; font-size: 0.8rem; display: none; margin-top: 5px; }
        
        .formula-box {
            margin-top: 15px;
            padding: 12px;
            background: #eef4f9;
            border-radius: 12px;
            font-family: monospace;
            font-size: 0.75rem;
            color: var(--formula-blue);
            line-height: 1.4;
            word-break: break-all;
        }

        .custom-fee-box, .shipping-box { 
            display: none; 
            margin-top: 10px; 
            padding: 10px;
            background: #fffafa;
            border-radius: 12px;
            border: 1px solid #ffecec;
        }

        .quote-label {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .label-no-ship { background: #e3f2fd; color: #1976d2; }
        .label-with-ship { background: #e8f5e9; color: #388e3c; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ‡°ğŸ‡· éŸ“åœ‹å°å¹«æ‰‹ã®è¨ˆç®—æ©Ÿ</h2>

    <div class="section">
        <label>ğŸ’° å•†å“éŸ“å¹£æ¨™åƒ¹ (KRW)</label>
        <input type="text" id="krwInput" inputmode="numeric" placeholder="è«‹è¼¸å…¥é‡‘é¡" oninput="calculate()">
    </div>

    <div class="section">
        <label>ğŸ ä»£è³¼å“é …</label>
        <select id="category" onchange="updateRateOptions()">
            <option value="1" data-rates="5,8">1. ç©å¶é¡ (5-8%)</option>
            <option value="2" data-rates="8,10,15">2. å’–å•¡å»³å‘¨é‚Š (8-15%)</option>
            <option value="3" data-rates="5,8">3. æ–‡å‰µå°åŠé£¾ (5-8%)</option>
            <option value="4" data-rates="5">4. æ˜ä¿¡ç‰‡/è²¼ç´™ (5%)</option>
            <option value="5" data-rates="5,8">5. å¤§å‰µé™å®š (5-8%)</option>
            <option value="6" data-rates="8,10">6. Olive Young (8-10%)</option>
            <option value="9" data-rates="8,10">9. æ¯ç›¤ (è«‹åŠ è™•ç†è²»)</option>
            <option value="11" data-rates="10,12">11. romand é™å®š (10-12%)</option>
            <option value="13" data-rates="10,12">13. é‹é¡/é‡ç‰© (10-12%)</option>
        </select>
    </div>

    <div class="section">
        <label>ğŸ“ˆ æœå‹™è²»ç‡ (%)</label>
        <div class="row">
            <select id="rateSelect" onchange="calculate()"></select>
            <label class="checkbox-group">
                <input type="checkbox" id="isCustomRate" onchange="toggleCustomRate()"> è‡ªè¨‚
            </label>
        </div>
        <div id="customRateBox" class="custom-fee-box">
            <input type="number" id="customRateInput" inputmode="numeric" placeholder="è¼¸å…¥è²»ç‡ (ä¾‹å¦‚ 12)" oninput="calculate()">
        </div>
    </div>

    <div class="section">
        <div class="row" style="margin-bottom: 10px;">
            <div style="flex:1">
                <label>ğŸ“¦ è™•ç†è²» H (TWD)</label>
                <input type="number" id="hCost" inputmode="numeric" value="0" oninput="calculate()">
            </div>
        </div>
        <label class="checkbox-group">
            <input type="checkbox" id="includeShipping" onchange="toggleShipping()"> åŠ ä¸Šå°ç£é‹è²» S
        </label>
        <div id="shippingBox" class="shipping-box">
            <input type="number" id="sCost" value="39" oninput="calculate()">
        </div>
    </div>

    <div class="result-card">
        <div id="quoteStatus" class="quote-label label-no-ship">ç´”å•†å“å ±åƒ¹</div>
        <div class="price-tag" id="totalDisplay">0<span>TWD</span></div>
        <div id="minFeeWarning" class="warning">âš ï¸ æœå‹™è²»ä¸è¶³ $50ï¼Œå·²æŒ‰ $50 è¨ˆç®—</div>
        
        <div class="tip" id="detailText" style="margin-top: 10px; border-top: 1px solid #ddd; padding-top: 10px;">
            è«‹è¼¸å…¥é‡‘é¡é–‹å§‹è¨ˆç®—
        </div>

        <div class="formula-box" id="formulaDisplay">
            å…¬å¼å›å ±ï¼šç­‰å¾…è¼¸å…¥ä¸­...
        </div>
    </div>
</div>

<script>
    const R = 45; 
    const M = 50; 

    function updateRateOptions() {
        const category = document.getElementById('category');
        const selected = category.options[category.selectedIndex];
        const rates = selected.getAttribute('data-rates').split(',');
        const rateSelect = document.getElementById('rateSelect');
        
        rateSelect.innerHTML = '';
        rates.forEach(r => {
            let opt = document.createElement('option');
            opt.value = r;
            opt.innerHTML = r + '%';
            rateSelect.appendChild(opt);
        });
        calculate();
    }

    function toggleCustomRate() {
        const isCustom = document.getElementById('isCustomRate').checked;
        document.getElementById('customRateBox').style.display = isCustom ? 'block' : 'none';
        document.getElementById('rateSelect').disabled = isCustom;
        calculate();
    }

    function toggleShipping() {
        const hasShipping = document.getElementById('includeShipping').checked;
        document.getElementById('shippingBox').style.display = hasShipping ? 'block' : 'none';
        
        const statusLabel = document.getElementById('quoteStatus');
        if(hasShipping) {
            statusLabel.innerText = "å«é‹ç¸½è¨ˆé‡‘é¡";
            statusLabel.className = "quote-label label-with-ship";
        } else {
            statusLabel.innerText = "ç´”å•†å“å ±åƒ¹";
            statusLabel.className = "quote-label label-no-ship";
        }
        calculate();
    }

    function roundToTen(num) {
        return Math.round(num / 10) * 10;
    }

    function calculate() {
        const P = parseFloat(document.getElementById('krwInput').value) || 0;
        const H = parseFloat(document.getElementById('hCost').value) || 0;
        const hasShipping = document.getElementById('includeShipping').checked;
        const S = hasShipping ? (parseFloat(document.getElementById('sCost').value) || 0) : 0;
        
        let rPercent;
        if (document.getElementById('isCustomRate').checked) {
            rPercent = parseFloat(document.getElementById('customRateInput').value) || 0;
        } else {
            rPercent = parseFloat(document.getElementById('rateSelect').value) || 0;
        }
        const r = rPercent / 100;

        if (P <= 0) {
            document.getElementById('totalDisplay').innerHTML = '0<span>TWD</span>';
            document.getElementById('detailText').innerHTML = 'è«‹è¼¸å…¥é‡‘é¡é–‹å§‹è¨ˆç®—';
            document.getElementById('formulaDisplay').innerText = 'å…¬å¼å›å ±ï¼šç­‰å¾…è¼¸å…¥ä¸­...';
            document.getElementById('minFeeWarning').style.display = 'none';
            return;
        }

        const twdBase = P / R;
        let serviceFee = twdBase * r;
        let isMinFeeUsed = false;

        if (serviceFee < M) {
            serviceFee = M;
            isMinFeeUsed = true;
            document.getElementById('minFeeWarning').style.display = 'block';
        } else {
            document.getElementById('minFeeWarning').style.display = 'none';
        }

        const rawTotal = twdBase + serviceFee + H + S;
        const finalTotal = roundToTen(rawTotal);

        document.getElementById('totalDisplay').innerHTML = `${finalTotal}<span>TWD</span>`;
        
        // æ›´æ–°ç´°ç¯€
        document.getElementById('detailText').innerHTML = `
            â€¢ å•†å“ï¼š$${twdBase.toFixed(1)}<br>
            â€¢ æœå‹™è²»ï¼š$${serviceFee.toFixed(1)} (${isMinFeeUsed ? 'ä¿åº•$50' : rPercent+'%'})<br>
            â€¢ å…¶ä»–ï¼šH $${H} / S $${S}
        `;

        // æ›´æ–°å…¬å¼å›å ± (å¯¦æ™‚é¡¯ç¤º)
        const feeStr = isMinFeeUsed ? `max(${twdBase.toFixed(0)}*${r}, 50)` : `(${twdBase.toFixed(0)}*${r})`;
        let formulaText = `(${P}Ã·${R}) + ${feeStr}`;
        if (H > 0) formulaText += ` + ${H}`;
        if (S > 0) formulaText += ` + ${S}`;
        formulaText += ` = ${rawTotal.toFixed(1)} â†’ å»ºè­°å ±åƒ¹ï¼š${finalTotal}`;
        
        document.getElementById('formulaDisplay').innerText = `å…¬å¼ï¼š${formulaText}`;
    }

    updateRateOptions();
</script>

</body>
</html>
